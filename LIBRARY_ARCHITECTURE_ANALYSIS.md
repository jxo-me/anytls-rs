# ðŸ“š åº“æž¶æž„åˆ†æžä¸Žå»ºè®®

**åˆ†æžæ—¥æœŸ**: 2025-11-03  
**é¡¹ç›®**: AnyTLS-RS v0.2.0  
**ç›®æ ‡**: è¯†åˆ«å¯ç‹¬ç«‹å°è£…çš„æ¨¡å—åŠè¯„ä¼°åˆ©å¼Š

---

## ðŸ“‹ ç›®å½•

1. [å½“å‰æž¶æž„](#å½“å‰æž¶æž„)
2. [å¯å°è£…çš„æ¨¡å—](#å¯å°è£…çš„æ¨¡å—)
3. [åº“åŒ–æ–¹æ¡ˆ](#åº“åŒ–æ–¹æ¡ˆ)
4. [ä¼˜ç¼ºç‚¹åˆ†æž](#ä¼˜ç¼ºç‚¹åˆ†æž)
5. [å®žæ–½å»ºè®®](#å®žæ–½å»ºè®®)

---

## å½“å‰æž¶æž„

### é¡¹ç›®ç»“æž„

```
anytls-rs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£
â”‚   â”œâ”€â”€ protocol/           # åè®®å±‚
â”‚   â”‚   â”œâ”€â”€ frame.rs        # Frame å®šä¹‰
â”‚   â”‚   â””â”€â”€ codec.rs        # ç¼–è§£ç å™¨
â”‚   â”œâ”€â”€ session/            # ä¼šè¯å±‚
â”‚   â”‚   â”œâ”€â”€ session.rs      # Session ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ stream.rs       # Stream å®žçŽ°
â”‚   â”‚   â””â”€â”€ stream_reader.rs# StreamReader
â”‚   â”œâ”€â”€ padding/            # å¡«å……ç®—æ³•
â”‚   â”‚   â””â”€â”€ factory.rs      # PaddingFactory
â”‚   â”œâ”€â”€ util/               # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ error.rs        # é”™è¯¯ç±»åž‹
â”‚   â”‚   â”œâ”€â”€ auth.rs         # è®¤è¯
â”‚   â”‚   â”œâ”€â”€ tls.rs          # TLS é…ç½®
â”‚   â”‚   â””â”€â”€ string_map.rs   # StringMap
â”‚   â”œâ”€â”€ client/             # å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ client.rs       # Client æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ socks5.rs       # SOCKS5 ä»£ç†
â”‚   â”‚   â””â”€â”€ session_pool.rs # ä¼šè¯æ± 
â”‚   â”œâ”€â”€ server/             # æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ server.rs       # Server æ ¸å¿ƒ
â”‚   â”‚   â””â”€â”€ handler.rs      # è¯·æ±‚å¤„ç†
â”‚   â””â”€â”€ bin/                # å¯æ‰§è¡Œæ–‡ä»¶
â”‚       â”œâ”€â”€ client.rs
â”‚       â””â”€â”€ server.rs
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   bin/*     â”‚
         â”‚ (å¯æ‰§è¡Œæ–‡ä»¶) â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚  client  â”‚         â”‚  server  â”‚
â”‚          â”‚         â”‚          â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    session     â”‚ â† æ ¸å¿ƒå±‚
        â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚ protocol â”‚ â”‚ padding â”‚ â”‚  util â”‚ â† åŸºç¡€å±‚
â”‚          â”‚ â”‚         â”‚ â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¯å°è£…çš„æ¨¡å—

### 1. Protocol å±‚ â­â­â­â­â­

**é€‚åˆåº¦**: éžå¸¸é«˜

#### å½“å‰å†…å®¹

- `frame.rs`: Frame ç»“æž„å’Œ Command æžšä¸¾
- `codec.rs`: FrameCodec ç¼–è§£ç å™¨

#### å¯å°è£…ä¸º

**åŒ…å**: `anytls-protocol`

**èŒè´£**:
- Frame å®šä¹‰å’Œæ“ä½œ
- Command ç±»åž‹æžšä¸¾
- ç¼–è§£ç å™¨å®žçŽ°
- åè®®å¸¸é‡å®šä¹‰

#### ç‹¬ç«‹æ€§è¯„ä¼°

| æ–¹é¢ | è¯„åˆ† | è¯´æ˜Ž |
|------|------|------|
| åŠŸèƒ½ç‹¬ç«‹æ€§ | â­â­â­â­â­ | å®Œå…¨ç‹¬ç«‹ï¼Œæ— ä¸šåŠ¡é€»è¾‘ |
| ä¾èµ–ç®€å•æ€§ | â­â­â­â­â­ | ä»…ä¾èµ– bytes, tokio-util |
| é€šç”¨æ€§ | â­â­â­â­â˜† | å¯ç”¨äºŽå…¶ä»– AnyTLS å®žçŽ° |
| ç¨³å®šæ€§ | â­â­â­â­â­ | åè®®ç¨³å®šï¼Œå˜åŒ–å°‘ |

#### ä¼˜ç‚¹

âœ… **å®Œå…¨ç‹¬ç«‹**: æ— ä¸šåŠ¡é€»è¾‘è€¦åˆ  
âœ… **åè®®æ ‡å‡†åŒ–**: å¯ä½œä¸º AnyTLS åè®®çš„ Rust æ ‡å‡†å®žçŽ°  
âœ… **è·¨é¡¹ç›®å¤ç”¨**: å…¶ä»– AnyTLS ç›¸å…³é¡¹ç›®å¯ä½¿ç”¨  
âœ… **ç‰ˆæœ¬æŽ§åˆ¶**: åè®®å˜æ›´å¯ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†  
âœ… **æµ‹è¯•ç‹¬ç«‹**: å¯ç‹¬ç«‹æµ‹è¯•åè®®æ­£ç¡®æ€§  

#### ç¼ºç‚¹

âš ï¸ **ç»´æŠ¤å¼€é”€**: éœ€è¦å•ç‹¬ç»´æŠ¤ç‰ˆæœ¬å’Œæ–‡æ¡£  
âš ï¸ **ç‰ˆæœ¬åŒæ­¥**: ä¸»é¡¹ç›®éœ€è¦è·Ÿè¸ªåè®®åº“ç‰ˆæœ¬  

#### ä»£ç ç¤ºä¾‹

```toml
# Cargo.toml (anytls-protocol)
[package]
name = "anytls-protocol"
version = "1.0.0"
description = "AnyTLS protocol implementation - Frame and Codec"

[dependencies]
bytes = "1.5"
tokio-util = { version = "0.7", features = ["codec"] }
```

---

### 2. Padding æ¨¡å— â­â­â­â­â˜†

**é€‚åˆåº¦**: é«˜

#### å½“å‰å†…å®¹

- `factory.rs`: PaddingFactory å®žçŽ°
- Padding æ–¹æ¡ˆç®¡ç†
- MD5 æ ¡éªŒ

#### å¯å°è£…ä¸º

**åŒ…å**: `anytls-padding` æˆ– `traffic-padding`

**èŒè´£**:
- Padding å¤§å°ç”Ÿæˆ
- Padding æ–¹æ¡ˆç®¡ç†
- æ–¹æ¡ˆå®Œæ•´æ€§æ ¡éªŒ

#### ç‹¬ç«‹æ€§è¯„ä¼°

| æ–¹é¢ | è¯„åˆ† | è¯´æ˜Ž |
|------|------|------|
| åŠŸèƒ½ç‹¬ç«‹æ€§ | â­â­â­â­â˜† | åŸºæœ¬ç‹¬ç«‹ï¼Œä¾èµ– AnyTLS é”™è¯¯ç±»åž‹ |
| ä¾èµ–ç®€å•æ€§ | â­â­â­â­â­ | ä»…ä¾èµ– md5, rand |
| é€šç”¨æ€§ | â­â­â­â­â­ | å¯ç”¨äºŽä»»ä½•éœ€è¦æµé‡æ··æ·†çš„åœºæ™¯ |
| ç¨³å®šæ€§ | â­â­â­â­â˜† | ç›¸å¯¹ç¨³å®šï¼Œå¶å°”æ·»åŠ æ–°æ–¹æ¡ˆ |

#### ä¼˜ç‚¹

âœ… **é€šç”¨æ€§å¼º**: ä¸é™äºŽ AnyTLSï¼Œå¯ç”¨äºŽå…¶ä»–ä»£ç†/VPN  
âœ… **ç®—æ³•ç‹¬ç«‹**: Padding ç®—æ³•ä¸Žåè®®è§£è€¦  
âœ… **å¯æ‰©å±•**: ä¾¿äºŽæ·»åŠ æ–°çš„ padding æ–¹æ¡ˆ  
âœ… **å¯æµ‹è¯•**: ç®—æ³•é€»è¾‘å¯ç‹¬ç«‹éªŒè¯  

#### ç¼ºç‚¹

âš ï¸ **é”™è¯¯ç±»åž‹ä¾èµ–**: å½“å‰ä¾èµ– `AnyTlsError`ï¼Œéœ€è¦æ³›åŒ–  
âš ï¸ **é€šç”¨æ€§æƒè¡¡**: è¿‡åº¦æ³›åŒ–å¯èƒ½å¢žåŠ å¤æ‚åº¦  

#### ä»£ç ç¤ºä¾‹

```toml
# Cargo.toml (anytls-padding æˆ– traffic-padding)
[package]
name = "traffic-padding"
version = "0.1.0"
description = "Traffic padding for obfuscation - Scheme-based padding generation"

[dependencies]
md5 = "0.8"
rand = "0.9"
thiserror = "2.0"  # å®šä¹‰è‡ªå·±çš„é”™è¯¯ç±»åž‹
```

---

### 3. Session æ ¸å¿ƒ â­â­â­â˜†â˜†

**é€‚åˆåº¦**: ä¸­ç­‰

#### å½“å‰å†…å®¹

- `session.rs`: Session ç®¡ç†
- `stream.rs`: Stream å®žçŽ°
- `stream_reader.rs`: StreamReader

#### å¯å°è£…ä¸º

**åŒ…å**: `anytls-session` æˆ– `anytls-core`

**èŒè´£**:
- å¤šè·¯å¤ç”¨ç®¡ç†
- Stream ç”Ÿå‘½å‘¨æœŸ
- Frame åˆ†å‘

#### ç‹¬ç«‹æ€§è¯„ä¼°

| æ–¹é¢ | è¯„åˆ† | è¯´æ˜Ž |
|------|------|------|
| åŠŸèƒ½ç‹¬ç«‹æ€§ | â­â­â­â˜†â˜† | ä¾èµ– protocol å’Œ padding |
| ä¾èµ–ç®€å•æ€§ | â­â­â­â˜†â˜† | éœ€è¦å¤šä¸ªå­åº“ |
| é€šç”¨æ€§ | â­â­â­â˜†â˜† | ä¸»è¦ç”¨äºŽ AnyTLS |
| ç¨³å®šæ€§ | â­â­â­â˜†â˜† | æ ¸å¿ƒé€»è¾‘ï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ– |

#### ä¼˜ç‚¹

âœ… **æ ¸å¿ƒé€»è¾‘å°è£…**: å¤šè·¯å¤ç”¨é€»è¾‘ç‹¬ç«‹  
âœ… **å®¢æˆ·ç«¯/æœåŠ¡å™¨å…±ç”¨**: å¯è¢« client å’Œ server åŒæ—¶ä½¿ç”¨  
âœ… **æµ‹è¯•ç‹¬ç«‹**: Session é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•  

#### ç¼ºç‚¹

âš ï¸ **ä¾èµ–å¤æ‚**: ä¾èµ– protocol, padding, util  
âš ï¸ **è€¦åˆåº¦é«˜**: ä¸Žä¸šåŠ¡é€»è¾‘æœ‰ä¸€å®šè€¦åˆ  
âš ï¸ **å˜åŒ–é¢‘ç¹**: æ ¸å¿ƒé€»è¾‘ä¼˜åŒ–å¯èƒ½å¯¼è‡´é¢‘ç¹æ›´æ–°  

---

### 4. Util å·¥å…·é›† â­â­â˜†â˜†â˜†

**é€‚åˆåº¦**: è¾ƒä½Ž

#### å½“å‰å†…å®¹

- `error.rs`: AnyTlsError é”™è¯¯ç±»åž‹
- `auth.rs`: è®¤è¯å·¥å…·
- `tls.rs`: TLS é…ç½®
- `string_map.rs`: StringMap å®žçŽ°

#### å¯å°è£…æ€§åˆ†æž

| æ¨¡å— | å¯ç‹¬ç«‹å°è£… | å»ºè®® |
|------|-----------|------|
| `error.rs` | âŒ å¦ | é¡¹ç›®ç‰¹å®šé”™è¯¯ç±»åž‹ |
| `auth.rs` | âš ï¸ å¯é€‰ | è®¤è¯é€»è¾‘ç›¸å¯¹ç‹¬ç«‹ |
| `tls.rs` | âŒ å¦ | é…ç½®è¾…åŠ©ï¼Œé¡¹ç›®ç‰¹å®š |
| `string_map.rs` | âš ï¸ å¯é€‰ | å¯ä½œä¸ºé€šç”¨æ•°æ®ç»“æž„ |

#### ä¸å»ºè®®ç‹¬ç«‹çš„åŽŸå› 

âŒ **è¿‡åº¦å·¥ç¨‹åŒ–**: ç®€å•å·¥å…·æ— éœ€ç‹¬ç«‹åº“  
âŒ **ç»´æŠ¤è´Ÿæ‹…**: å¢žåŠ ç»´æŠ¤å¤æ‚åº¦  
âŒ **é¡¹ç›®ç‰¹å®š**: å¤§éƒ¨åˆ†å·¥å…·ä¸Ž AnyTLS ç´§å¯†ç›¸å…³  

---

### 5. Client/Server âŒ

**é€‚åˆåº¦**: ä¸é€‚åˆ

#### åŽŸå› 

âŒ **åº”ç”¨å±‚**: ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ˜¯å¯å¤ç”¨ç»„ä»¶  
âŒ **é¡¹ç›®ç‰¹å®š**: ä¸Žå…·ä½“å®žçŽ°ç´§å¯†è€¦åˆ  
âŒ **å¿«é€Ÿè¿­ä»£**: éœ€è¦é¢‘ç¹ä¿®æ”¹å’Œä¼˜åŒ–  

---

## åº“åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æœ€å°åº“åŒ– â­â­â­â­â­

**æŽ¨èæŒ‡æ•°**: æœ€é«˜

#### ç»“æž„

```
workspace/
â”œâ”€â”€ anytls-protocol/        # åè®®åº“
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ frame.rs
â”‚       â””â”€â”€ codec.rs
â”œâ”€â”€ anytls-rs/              # ä¸»é¡¹ç›®
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ session/
â”‚       â”œâ”€â”€ padding/
â”‚       â”œâ”€â”€ util/
â”‚       â”œâ”€â”€ client/
â”‚       â”œâ”€â”€ server/
â”‚       â””â”€â”€ bin/
```

#### Cargo.toml (ä¸»é¡¹ç›®)

```toml
[workspace]
members = [
    "anytls-protocol",
    "anytls-rs"
]

[dependencies]
# anytls-protocol = { path = "../anytls-protocol" }
anytls-protocol = "1.0"  # å‘å¸ƒåŽä½¿ç”¨
```

#### ä¼˜ç‚¹

âœ… **æœ€å°æ”¹åŠ¨**: åªæŠ½å–æœ€ç‹¬ç«‹çš„éƒ¨åˆ†  
âœ… **é™ä½Žé£Žé™©**: å½±å“èŒƒå›´å°  
âœ… **æ˜“äºŽç»´æŠ¤**: ç®¡ç†å¤æ‚åº¦æœ€ä½Ž  
âœ… **åè®®æ ‡å‡†åŒ–**: Protocol å±‚ç‹¬ç«‹ä¾¿äºŽå…¶ä»–å®žçŽ°å¤ç”¨  

#### ç¼ºç‚¹

âš ï¸ **å¤ç”¨æœ‰é™**: ä»… protocol å±‚å¯å¤ç”¨  

---

### æ–¹æ¡ˆ B: ä¸­åº¦åº“åŒ– â­â­â­â˜†â˜†

**æŽ¨èæŒ‡æ•°**: ä¸­ç­‰

#### ç»“æž„

```
workspace/
â”œâ”€â”€ anytls-protocol/        # åè®®åº“
â”œâ”€â”€ anytls-padding/         # Padding åº“
â”œâ”€â”€ anytls-core/            # Session æ ¸å¿ƒåº“
â””â”€â”€ anytls-rs/              # ä¸»é¡¹ç›®
    â””â”€â”€ src/
        â”œâ”€â”€ util/
        â”œâ”€â”€ client/
        â”œâ”€â”€ server/
        â””â”€â”€ bin/
```

#### ä¼˜ç‚¹

âœ… **æ›´å¥½çš„å¤ç”¨**: å¤šä¸ªæ¨¡å—å¯ç‹¬ç«‹ä½¿ç”¨  
âœ… **æ¸…æ™°åˆ†å±‚**: åè®®ã€æ ¸å¿ƒã€åº”ç”¨åˆ†ç¦»  
âœ… **çµæ´»æ€§é«˜**: å¯é€‰æ‹©æ€§ä½¿ç”¨ä¸åŒç»„ä»¶  

#### ç¼ºç‚¹

âš ï¸ **ç»´æŠ¤æˆæœ¬å¢žåŠ **: éœ€è¦ç®¡ç† 3 ä¸ªåº“  
âš ï¸ **ç‰ˆæœ¬åŒæ­¥**: åº“ä¹‹é—´ç‰ˆæœ¬ä¾èµ–å¤æ‚  
âš ï¸ **å¼€å‘æ•ˆçŽ‡**: è·¨åº“ä¿®æ”¹è°ƒè¯•å¤æ‚  

---

### æ–¹æ¡ˆ C: å®Œå…¨åº“åŒ– â­â­â˜†â˜†â˜†

**æŽ¨èæŒ‡æ•°**: è¾ƒä½Ž

#### ç»“æž„

```
workspace/
â”œâ”€â”€ anytls-protocol/
â”œâ”€â”€ anytls-padding/
â”œâ”€â”€ anytls-session/
â”œâ”€â”€ anytls-client/
â”œâ”€â”€ anytls-server/
â””â”€â”€ anytls-cli/             # ä»…äºŒè¿›åˆ¶
```

#### ä¼˜ç‚¹

âœ… **æœ€å¤§å¤ç”¨**: æ‰€æœ‰ç»„ä»¶å¯ç‹¬ç«‹ä½¿ç”¨  
âœ… **æ’ä»¶åŒ–**: ä¾¿äºŽç¬¬ä¸‰æ–¹æ‰©å±•  

#### ç¼ºç‚¹

âŒ **è¿‡åº¦å·¥ç¨‹åŒ–**: å¯¹äºŽå½“å‰é¡¹ç›®è§„æ¨¡ä¸å¿…è¦  
âŒ **ç»´æŠ¤è´Ÿæ‹…**: 5+ ä¸ªç‹¬ç«‹åº“éš¾ä»¥ç»´æŠ¤  
âŒ **å¼€å‘æ•ˆçŽ‡ä½Ž**: ä¸¥é‡å½±å“å¼€å‘é€Ÿåº¦  
âŒ **ç‰ˆæœ¬ç®¡ç†å¤æ‚**: å¤šåº“ä¾èµ–é“¾ç®¡ç†å›°éš¾  

---

## ä¼˜ç¼ºç‚¹åˆ†æž

### åº“åŒ–çš„é€šç”¨ä¼˜ç‚¹ âœ…

#### 1. ä»£ç å¤ç”¨

**åœºæ™¯**: å…¶ä»–é¡¹ç›®éœ€è¦ç›¸åŒåŠŸèƒ½

```
é¡¹ç›® A (anytls-rs)      â”€â”
é¡¹ç›® B (anytls-go-ffi)  â”€â”¼â”€â”€> anytls-protocol
é¡¹ç›® C (anytls-test)    â”€â”˜
```

**ä¼˜åŠ¿**:
- é¿å…ä»£ç é‡å¤
- ç»Ÿä¸€å®žçŽ°æ ‡å‡†
- å‡å°‘ç»´æŠ¤æˆæœ¬

#### 2. ç‰ˆæœ¬ç®¡ç†

**ä¼˜åŠ¿**:
- åè®®å˜æ›´å¯ç‹¬ç«‹ç‰ˆæœ¬åŒ–
- å‘åŽå…¼å®¹æ€§æ˜Žç¡®
- SemVer è¯­ä¹‰åŒ–ç‰ˆæœ¬

```
anytls-protocol v1.0.0 â† ç¨³å®šåè®®
anytls-protocol v2.0.0 â† åè®®å‡çº§ï¼ˆç ´åæ€§ï¼‰
```

#### 3. æµ‹è¯•ç‹¬ç«‹

**ä¼˜åŠ¿**:
- å•å…ƒæµ‹è¯•æ›´ä¸“æ³¨
- CI/CD å¯ç‹¬ç«‹è¿è¡Œ
- æµ‹è¯•è¦†ç›–çŽ‡æ›´æ¸…æ™°

```bash
cd anytls-protocol
cargo test  # ä»…æµ‹è¯•åè®®å±‚
```

#### 4. æ–‡æ¡£ç‹¬ç«‹

**ä¼˜åŠ¿**:
- API æ–‡æ¡£æ›´æ¸…æ™°
- ç”¨æˆ·åªéœ€å…³æ³¨æ‰€éœ€æ¨¡å—
- ä¾¿äºŽç”Ÿæˆä¸“é¡¹æ–‡æ¡£

```bash
cd anytls-protocol
cargo doc --open  # ä»…åè®®å±‚æ–‡æ¡£
```

#### 5. å‘å¸ƒç‹¬ç«‹

**ä¼˜åŠ¿**:
- å¯å•ç‹¬å‘å¸ƒåˆ° crates.io
- å…¶ä»–å¼€å‘è€…å¯ç›´æŽ¥ä½¿ç”¨
- æé«˜é¡¹ç›®å½±å“åŠ›

```toml
[dependencies]
anytls-protocol = "1.0"  # ä»»ä½•é¡¹ç›®å¯ä½¿ç”¨
```

---

### åº“åŒ–çš„é€šç”¨ç¼ºç‚¹ âš ï¸

#### 1. ç»´æŠ¤æˆæœ¬å¢žåŠ 

**é—®é¢˜**:
- å¤šä¸ª Cargo.toml éœ€è¦ç»´æŠ¤
- å¤šä¸ª README å’Œæ–‡æ¡£
- å¤šä¸ªç‰ˆæœ¬éœ€è¦ç®¡ç†

**ç¤ºä¾‹**:
```
ä¿®æ”¹ä¸€ä¸ª APIï¼š
1. æ›´æ–° anytls-protocol
2. å‘å¸ƒæ–°ç‰ˆæœ¬
3. æ›´æ–° anytls-rs çš„ä¾èµ–
4. æµ‹è¯•é›†æˆ
5. å‘å¸ƒä¸»é¡¹ç›®
```

#### 2. ç‰ˆæœ¬åŒæ­¥å¤æ‚

**é—®é¢˜**:
- åº“ä¹‹é—´çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»
- è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†å›°éš¾
- ç ´åæ€§æ›´æ”¹å½±å“èŒƒå›´å¤§

**ç¤ºä¾‹**:
```
anytls-protocol 2.0.0 (ç ´åæ€§æ›´æ”¹)
  â†“
anytls-core ä¾èµ– ^1.0  # ä¸å…¼å®¹ï¼
  â†“
anytls-rs æ— æ³•ä½¿ç”¨æ–°åè®®
```

#### 3. å¼€å‘æ•ˆçŽ‡é™ä½Ž

**é—®é¢˜**:
- è·¨åº“ä¿®æ”¹éœ€è¦å¤šæ¬¡ç¼–è¯‘
- è°ƒè¯•å˜å¾—å¤æ‚
- éœ€è¦ä½¿ç”¨ workspace æˆ– path ä¾èµ–

**ç¤ºä¾‹**:
```bash
# ä¿®æ”¹ protocol åŽ
cd anytls-protocol
cargo build

cd ../anytls-rs
cargo build  # åˆè¦é‡æ–°ç¼–è¯‘ä¸€æ¬¡
```

#### 4. ä¾èµ–ç®¡ç†å¤æ‚

**é—®é¢˜**:
- Cargo.lock å¯èƒ½å†²çª
- ä¼ é€’ä¾èµ–ç‰ˆæœ¬å†²çª
- Workspace é…ç½®å¤æ‚

#### 5. å‘å¸ƒæµç¨‹å¤æ‚

**é—®é¢˜**:
- éœ€è¦æŒ‰é¡ºåºå‘å¸ƒ
- ç‰ˆæœ¬å·éœ€è¦åè°ƒ
- å›žæ»šå›°éš¾

**ç¤ºä¾‹**:
```
å‘å¸ƒé¡ºåº:
1. anytls-protocol 1.0.1
2. anytls-padding 0.2.0 (ä¾èµ– protocol 1.0.1)
3. anytls-core 0.3.0 (ä¾èµ– protocol 1.0.1, padding 0.2.0)
4. anytls-rs 0.2.1 (ä¾èµ–æ‰€æœ‰)
```

#### 6. è¿‡æ—©ä¼˜åŒ–

**é—®é¢˜**:
- åœ¨éœ€æ±‚ä¸æ˜Žç¡®æ—¶è¿‡æ—©æŠ½è±¡
- å¯èƒ½æŠ½è±¡å‡ºä¸åˆé€‚çš„æŽ¥å£
- é‡æž„æˆæœ¬å¢žåŠ 

---

## å®žæ–½å»ºè®®

### æŽ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆ A (æœ€å°åº“åŒ–) â­

#### ç¬¬ä¸€é˜¶æ®µï¼šä»…æŠ½å– Protocol

**ç†ç”±**:
1. âœ… Protocol å±‚æœ€ç¨³å®š
2. âœ… ä¾èµ–æœ€ç®€å•
3. âœ… å¤ç”¨ä»·å€¼æœ€é«˜
4. âœ… é£Žé™©æœ€ä½Ž

#### å®žæ–½æ­¥éª¤

**1. åˆ›å»º Workspace**

```toml
# ./Cargo.toml (workspace root)
[workspace]
members = [
    "anytls-protocol",
    "anytls-rs"
]
resolver = "2"
```

**2. åˆ›å»º Protocol åº“**

```bash
mkdir anytls-protocol
cd anytls-protocol
cargo init --lib
```

```toml
# anytls-protocol/Cargo.toml
[package]
name = "anytls-protocol"
version = "1.0.0"
edition = "2021"
description = "AnyTLS protocol - Frame and codec implementation"
license = "MIT"
repository = "https://github.com/yourusername/anytls-rs"

[dependencies]
bytes = "1.5"
tokio-util = { version = "0.7", features = ["codec"] }
```

**3. ç§»åŠ¨ä»£ç **

```bash
# ç§»åŠ¨ protocol æ¨¡å—
mv src/protocol/frame.rs anytls-protocol/src/
mv src/protocol/codec.rs anytls-protocol/src/

# åˆ›å»º lib.rs
cat > anytls-protocol/src/lib.rs << 'EOF'
//! AnyTLS Protocol - Frame and codec implementation

mod frame;
mod codec;

pub use frame::*;
pub use codec::*;
EOF
```

**4. æ›´æ–°ä¸»é¡¹ç›®ä¾èµ–**

```toml
# anytls-rs/Cargo.toml
[dependencies]
anytls-protocol = { path = "../anytls-protocol" }
# æˆ–å‘å¸ƒåŽ: anytls-protocol = "1.0"
```

**5. æ›´æ–°ä¸»é¡¹ç›®ä»£ç **

```rust
// src/lib.rs
// ç§»é™¤ pub mod protocol;
// ä½¿ç”¨å¤–éƒ¨åº“
pub use anytls_protocol::*;
```

#### ç¬¬äºŒé˜¶æ®µï¼šæ ¹æ®éœ€è¦æŠ½å– Padding (å¯é€‰)

**æ¡ä»¶**: 
- å…¶ä»–é¡¹ç›®éœ€è¦ padding åŠŸèƒ½
- Padding ç®—æ³•è¶‹äºŽç¨³å®š

#### ç¬¬ä¸‰é˜¶æ®µï¼šè¯„ä¼° Session å±‚ (è¿œæœŸ)

**æ¡ä»¶**:
- éœ€è¦æ”¯æŒå¤šç§ä¼ è¾“å±‚
- æœ‰æ˜Žç¡®çš„ç¬¬ä¸‰æ–¹ä½¿ç”¨éœ€æ±‚

---

### ä¸æŽ¨èçš„åšæ³• âŒ

#### 1. è¿‡æ—©å…¨é¢åº“åŒ–

```
âŒ ä¸€æ¬¡æ€§æŠ½å–æ‰€æœ‰æ¨¡å—ä¸ºç‹¬ç«‹åº“
âŒ åœ¨éœ€æ±‚ä¸æ˜Žç¡®æ—¶è¿‡åº¦æŠ½è±¡
âŒ ä¸ºäº†"çœ‹èµ·æ¥ä¸“ä¸š"è€Œåº“åŒ–
```

#### 2. åº“åŒ–ä¸ç¨³å®šæ¨¡å—

```
âŒ æŠ½å–æ­£åœ¨é¢‘ç¹ä¿®æ”¹çš„ä»£ç 
âŒ æŠ½å–ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆclient/serverï¼‰
âŒ æŠ½å–é¡¹ç›®ç‰¹å®šçš„å·¥å…·å‡½æ•°
```

#### 3. å¿½ç•¥ç»´æŠ¤æˆæœ¬

```
âŒ åˆ›å»ºå¤§é‡å°åž‹åº“
âŒ ä¸è€ƒè™‘ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
âŒ æ²¡æœ‰æ˜Žç¡®çš„å‘å¸ƒæµç¨‹
```

---

## å†³ç­–çŸ©é˜µ

### æ˜¯å¦åº”è¯¥å°è£…ä¸ºåº“ï¼Ÿ

ä½¿ç”¨ä»¥ä¸‹çŸ©é˜µè¯„ä¼°ï¼š

| å› ç´  | æƒé‡ | Protocol | Padding | Session | Util | Client/Server |
|------|------|---------|---------|---------|------|--------------|
| åŠŸèƒ½ç‹¬ç«‹æ€§ | 30% | â­â­â­â­â­ | â­â­â­â­â˜† | â­â­â­â˜†â˜† | â­â­â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† |
| å¤ç”¨éœ€æ±‚ | 25% | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â˜†â˜† | â­â­â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† |
| ç¨³å®šæ€§ | 20% | â­â­â­â­â­ | â­â­â­â­â˜† | â­â­â­â˜†â˜† | â­â­â­â˜†â˜† | â­â­â˜†â˜†â˜† |
| ç»´æŠ¤æˆæœ¬ | 15% | â­â­â­â­â­ | â­â­â­â­â˜† | â­â­â­â˜†â˜† | â­â­â˜†â˜†â˜† | â­â­â˜†â˜†â˜† |
| ä¾èµ–ç®€å•æ€§ | 10% | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â˜†â˜† | â­â­â­â˜†â˜† | â­â­â˜†â˜†â˜† |
| **æ€»åˆ†** | **100%** | **94%** | **87%** | **60%** | **44%** | **28%** |
| **å»ºè®®** | - | **âœ… å¼ºçƒˆæŽ¨è** | **âœ… æŽ¨è** | **âš ï¸ å¯é€‰** | **âŒ ä¸æŽ¨è** | **âŒ ä¸æŽ¨è** |

---

## å®žé™…æ¡ˆä¾‹å‚è€ƒ

### Tokio ç”Ÿæ€ç³»ç»Ÿ

```
tokio/              # æ ¸å¿ƒè¿è¡Œæ—¶
tokio-util/         # å·¥å…·åº“ï¼ˆcodec ç­‰ï¼‰
tokio-stream/       # Stream trait
tokio-test/         # æµ‹è¯•å·¥å…·
```

**å€Ÿé‰´**:
- æ ¸å¿ƒç¨³å®šå±‚ç‹¬ç«‹ï¼ˆtokioï¼‰
- å·¥å…·å±‚ç‹¬ç«‹ï¼ˆtokio-utilï¼‰
- ä¸“é¡¹åŠŸèƒ½ç‹¬ç«‹ï¼ˆtokio-streamï¼‰

### Hyper ç”Ÿæ€ç³»ç»Ÿ

```
http/               # HTTP ç±»åž‹å®šä¹‰
hyper/              # HTTP å®¢æˆ·ç«¯/æœåŠ¡å™¨
hyper-tls/          # TLS æ”¯æŒ
```

**å€Ÿé‰´**:
- åè®®ç±»åž‹ç‹¬ç«‹ï¼ˆhttpï¼‰
- å®žçŽ°å±‚é›†æˆï¼ˆhyperï¼‰
- æ‰©å±•åŠŸèƒ½å¯é€‰ï¼ˆhyper-tlsï¼‰

---

## æœ€ç»ˆå»ºè®®

### å½“å‰é˜¶æ®µï¼ˆv0.2.0ï¼‰

**å»ºè®®**: ä¿æŒå•ä½“æž¶æž„ âœ…

**ç†ç”±**:
1. âœ… é¡¹ç›®å¤„äºŽå¿«é€Ÿè¿­ä»£æœŸ
2. âœ… æ ¸å¿ƒåŠŸèƒ½è¿˜åœ¨ä¼˜åŒ–
3. âœ… æ²¡æœ‰æ˜Žç¡®çš„å¤–éƒ¨å¤ç”¨éœ€æ±‚
4. âœ… ç»´æŠ¤ç®€å•ï¼Œå¼€å‘é«˜æ•ˆ

### ä¸‹ä¸€é˜¶æ®µï¼ˆv0.3.0+ï¼‰

**å»ºè®®**: æŠ½å– Protocol å±‚ âœ…

**æ¡ä»¶**:
- [ ] åè®®ç¨³å®šï¼ˆ1-2 ä¸ªæœˆæ— é‡å¤§å˜æ›´ï¼‰
- [ ] æœ‰å…¶ä»–é¡¹ç›®éœ€è¦ä½¿ç”¨
- [ ] æœ‰æ˜Žç¡®çš„ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

### é•¿æœŸï¼ˆv1.0.0+ï¼‰

**å»ºè®®**: è¯„ä¼° Padding å±‚ç‹¬ç«‹ âš ï¸

**æ¡ä»¶**:
- [ ] Protocol å±‚å·²æˆåŠŸç‹¬ç«‹
- [ ] Padding ç®—æ³•ç¨³å®š
- [ ] æœ‰é€šç”¨æ€§éœ€æ±‚

---

## æ£€æŸ¥æ¸…å•

### åº“åŒ–å‰ç¡®è®¤

- [ ] æ¨¡å—åŠŸèƒ½æ˜Žç¡®ä¸”ç¨³å®š
- [ ] æœ‰æ˜Žç¡®çš„å¤ç”¨åœºæ™¯
- [ ] ä¾èµ–å…³ç³»ç®€å•æ¸…æ™°
- [ ] æœ‰ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
- [ ] æœ‰æµ‹è¯•è¦†ç›–
- [ ] æœ‰æ–‡æ¡£è¯´æ˜Ž
- [ ] å›¢é˜Ÿæœ‰ç»´æŠ¤èƒ½åŠ›

### åº“åŒ–åŽç›‘æŽ§

- [ ] ç‰ˆæœ¬æ›´æ–°é¢‘çŽ‡æ˜¯å¦åˆç†
- [ ] æ˜¯å¦æœ‰å¤–éƒ¨é¡¹ç›®ä½¿ç”¨
- [ ] ç»´æŠ¤æˆæœ¬æ˜¯å¦å¯æŽ§
- [ ] å¼€å‘æ•ˆçŽ‡æ˜¯å¦å—å½±å“

---

## æ€»ç»“

### ðŸŽ¯ æ ¸å¿ƒå»ºè®®

1. **å½“å‰é˜¶æ®µ**: ä¿æŒå•ä½“æž¶æž„ï¼Œä¸“æ³¨åŠŸèƒ½å¼€å‘
2. **è¿‘æœŸè®¡åˆ’**: ç­‰å¾… v0.3.0+ï¼Œè€ƒè™‘æŠ½å– Protocol å±‚
3. **å®žæ–½æ–¹å¼**: é‡‡ç”¨ Cargo Workspaceï¼Œæ¸è¿›å¼é‡æž„
4. **éµå¾ªåŽŸåˆ™**: æŒ‰éœ€æŠ½å–ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–

### â­ ä¼˜å…ˆçº§æŽ’åº

1. **Protocol å±‚** - å¼ºçƒˆæŽ¨èç‹¬ç«‹ï¼ˆåè®®ç¨³å®šåŽï¼‰
2. **Padding å±‚** - å¯é€‰ç‹¬ç«‹ï¼ˆæœ‰é€šç”¨éœ€æ±‚æ—¶ï¼‰
3. **Session å±‚** - è¿œæœŸè€ƒè™‘ï¼ˆå¤šç§ä½¿ç”¨åœºæ™¯æ—¶ï¼‰
4. **Util å·¥å…·** - ä¸æŽ¨èç‹¬ç«‹
5. **Client/Server** - ä¸æŽ¨èç‹¬ç«‹

### ðŸ’¡ å…³é”®åŽŸåˆ™

- âœ… **æŒ‰éœ€æŠ½å–**ï¼Œä¸æ˜¯ä¸ºäº†åº“åŒ–è€Œåº“åŒ–
- âœ… **ç¨³å®šä¼˜å…ˆ**ï¼Œé¢‘ç¹å˜åŒ–çš„ä»£ç ä¸é€‚åˆç‹¬ç«‹
- âœ… **ç®€å•è‡³ä¸Š**ï¼Œç»´æŠ¤æˆæœ¬è¦å¯æŽ§
- âœ… **ä»·å€¼å¯¼å‘**ï¼Œè¦æœ‰æ˜Žç¡®çš„å¤ç”¨ä»·å€¼

---

**åˆ¶å®šæ—¥æœŸ**: 2025-11-03  
**é€‚ç”¨ç‰ˆæœ¬**: v0.2.0+  
**ä¸‹æ¬¡è¯„ä¼°**: v0.3.0 å‘å¸ƒå‰

---

*"è¿‡æ—©çš„æŠ½è±¡æ˜¯ä¸‡æ¶ä¹‹æº" - Donald Knuth*

