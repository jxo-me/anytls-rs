# ğŸ’“ å¿ƒè·³åŠŸèƒ½ Go äº’æ“ä½œæµ‹è¯•æŒ‡å—

**åŠŸèƒ½**: HeartRequest/HeartResponse è¢«åŠ¨å“åº”  
**ç‰ˆæœ¬**: v0.3.0  
**æ—¥æœŸ**: 2025-11-03

---

## ğŸ“‹ æµ‹è¯•ç›®æ ‡

éªŒè¯ Rust å®ç°çš„å¿ƒè·³æœºåˆ¶ä¸ Go å®ç°å®Œå…¨å…¼å®¹ã€‚

---

## ğŸ”§ æµ‹è¯•ç¯å¢ƒ

### å‰ç½®æ¡ä»¶

- âœ… Rust å®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼ˆv0.3.0ï¼‰
- âœ… Go å®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼ˆv0.0.10+ï¼‰
- âœ… ä¸¤ç«¯éƒ½æ”¯æŒåè®®ç‰ˆæœ¬ 2

---

## ğŸ“ æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: Rust æœåŠ¡å™¨ + Go å®¢æˆ·ç«¯

#### 1.1 å¯åŠ¨ Rust æœåŠ¡å™¨

```bash
# ç»ˆç«¯ 1
cd d:\dev\rust\anytls-rs
cargo run --release --bin anytls-server -- \
  -l 127.0.0.1:8443 \
  -p test_password
```

#### 1.2 å¯åŠ¨ Go å®¢æˆ·ç«¯

```bash
# ç»ˆç«¯ 2
cd anytls-go
go run ./cmd/client \
  --server 127.0.0.1:8443 \
  --password test_password \
  --listen 127.0.0.1:1080
```

#### 1.3 å‘é€æµ‹è¯•è¯·æ±‚

```bash
# ç»ˆç«¯ 3
for i in {1..10}; do
  echo "Request $i"
  curl --socks5-hostname 127.0.0.1:1080 http://httpbin.org/get
  sleep 1
done
```

#### 1.4 è§‚å¯Ÿæ—¥å¿—

**Rust æœåŠ¡å™¨æ—¥å¿—**:
```
[Session] ğŸ’“ Received HeartRequest (stream_id=...)
[Session] âœ… Sent HeartResponse (stream_id=...)
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] âœ… Rust æœåŠ¡å™¨æ”¶åˆ° Go å®¢æˆ·ç«¯çš„ HeartRequest
- [ ] âœ… Rust æœåŠ¡å™¨æ­£ç¡®å‘é€ HeartResponse
- [ ] âœ… æ‰€æœ‰è¯·æ±‚æˆåŠŸ
- [ ] âœ… æ— é”™è¯¯æˆ–è¶…æ—¶

---

### åœºæ™¯ 2: Go æœåŠ¡å™¨ + Rust å®¢æˆ·ç«¯

#### 2.1 å¯åŠ¨ Go æœåŠ¡å™¨

```bash
# ç»ˆç«¯ 1
cd anytls-go
go run ./cmd/server \
  --listen 127.0.0.1:8443 \
  --password test_password
```

#### 2.2 å¯åŠ¨ Rust å®¢æˆ·ç«¯

```bash
# ç»ˆç«¯ 2
cd d:\dev\rust\anytls-rs
cargo run --release --bin anytls-client -- \
  -l 127.0.0.1:1080 \
  -s 127.0.0.1:8443 \
  -p test_password
```

#### 2.3 å‘é€æµ‹è¯•è¯·æ±‚

```bash
# ç»ˆç«¯ 3ï¼ˆåŒåœºæ™¯ 1ï¼‰
for i in {1..10}; do
  echo "Request $i"
  curl --socks5-hostname 127.0.0.1:1080 http://httpbin.org/get
  sleep 1
done
```

#### 2.4 è§‚å¯Ÿæ—¥å¿—

**Go æœåŠ¡å™¨æ—¥å¿—**:
```
æ”¶åˆ°å¿ƒè·³è¯·æ±‚å¹¶å“åº”ï¼ˆGo çš„æ—¥å¿—æ ¼å¼ï¼‰
```

**Rust å®¢æˆ·ç«¯æ—¥å¿—**:
```
[Session] ğŸ’š Received HeartResponse (stream_id=...)
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] âœ… Go æœåŠ¡å™¨æ”¶åˆ° Rust å®¢æˆ·ç«¯çš„ HeartRequestï¼ˆå¦‚æœå‘é€ï¼‰
- [ ] âœ… Go æœåŠ¡å™¨æ­£ç¡®å‘é€ HeartResponse
- [ ] âœ… Rust å®¢æˆ·ç«¯æ­£ç¡®æ¥æ”¶ HeartResponse
- [ ] âœ… æ‰€æœ‰è¯·æ±‚æˆåŠŸ
- [ ] âœ… æ— é”™è¯¯æˆ–è¶…æ—¶

---

### åœºæ™¯ 3: åŒå‘å¿ƒè·³æµ‹è¯•

#### 3.1 å‡†å¤‡

ä»»é€‰ä¸Šè¿°åœºæ™¯ä¹‹ä¸€ï¼ˆRust æœåŠ¡å™¨ + Go å®¢æˆ·ç«¯ æˆ– Go æœåŠ¡å™¨ + Rust å®¢æˆ·ç«¯ï¼‰

#### 3.2 æ‰‹åŠ¨å‘é€å¿ƒè·³

**æ–¹å¼ 1**: ä¿®æ”¹ä»£ç æ·»åŠ å®šæœŸå¿ƒè·³

```rust
// Rust å®¢æˆ·ç«¯ä¸­æ·»åŠ 
tokio::spawn(async move {
    loop {
        tokio::time::sleep(Duration::from_secs(10)).await;
        let _ = session.write_control_frame(
            Frame::control(Command::HeartRequest, 0)
        ).await;
    }
});
```

**æ–¹å¼ 2**: ä½¿ç”¨è°ƒè¯•å·¥å…·å‘é€å¿ƒè·³å¸§

#### 3.3 éªŒè¯

**éªŒæ”¶æ ‡å‡†**:
- [ ] âœ… åŒæ–¹éƒ½èƒ½æ­£ç¡®æ¥æ”¶å¯¹æ–¹çš„å¿ƒè·³
- [ ] âœ… åŒæ–¹éƒ½èƒ½æ­£ç¡®å“åº”å¿ƒè·³
- [ ] âœ… å¿ƒè·³ä¸å½±å“æ­£å¸¸çš„æ•°æ®ä¼ è¾“
- [ ] âœ… é•¿æ—¶é—´è¿è¡Œæ— é—®é¢˜ï¼ˆ10åˆ†é’Ÿ+ï¼‰

---

## âœ… éªŒæ”¶æ£€æŸ¥æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ] Rust æœåŠ¡å™¨èƒ½å“åº” Go å®¢æˆ·ç«¯å¿ƒè·³
- [ ] Go æœåŠ¡å™¨èƒ½å“åº” Rust å®¢æˆ·ç«¯å¿ƒè·³ï¼ˆå¦‚å‘é€ï¼‰
- [ ] Rust å®¢æˆ·ç«¯èƒ½æ¥æ”¶ Go æœåŠ¡å™¨å¿ƒè·³å“åº”
- [ ] Go å®¢æˆ·ç«¯èƒ½æ¥æ”¶ Rust æœåŠ¡å™¨å¿ƒè·³å“åº”
- [ ] å¿ƒè·³ä¸å½±å“æ­£å¸¸ä»£ç†åŠŸèƒ½
- [ ] å¤šæ¬¡å¿ƒè·³æ­£å¸¸å·¥ä½œ
- [ ] å‹åŠ›æµ‹è¯•ä¸‹å¿ƒè·³æ­£å¸¸

### æ—¥å¿—éªŒè¯

- [ ] Rust ç«¯æ—¥å¿—æ­£ç¡®è®°å½• HeartRequest æ¥æ”¶
- [ ] Rust ç«¯æ—¥å¿—æ­£ç¡®è®°å½• HeartResponse å‘é€
- [ ] Rust ç«¯æ—¥å¿—æ­£ç¡®è®°å½• HeartResponse æ¥æ”¶
- [ ] æ— é”™è¯¯æˆ–è­¦å‘Šæ—¥å¿—

### æ€§èƒ½éªŒè¯

- [ ] å¿ƒè·³å“åº”å»¶è¿Ÿ < 100ms
- [ ] å¿ƒè·³ä¸å¯¼è‡´æ€§èƒ½ä¸‹é™
- [ ] å¿ƒè·³å¼€é”€ < 0.1% CPU

---

## ğŸ” é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: æœªæ”¶åˆ° HeartResponse

**å¯èƒ½åŸå› **:
- Command æšä¸¾å€¼ä¸åŒ¹é…
- å¸§ç¼–ç é”™è¯¯
- ç½‘ç»œé—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰ "Received HeartRequest"
2. æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰ "Sent HeartResponse"
3. ä½¿ç”¨ Wireshark æŠ“åŒ…æ£€æŸ¥å¸§æ ¼å¼

### é—®é¢˜ 2: å¿ƒè·³å¯¼è‡´è¿æ¥æ–­å¼€

**å¯èƒ½åŸå› **:
- é”™è¯¯å¤„ç†é€»è¾‘é—®é¢˜
- Session çŠ¶æ€å¼‚å¸¸

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥ Session æ˜¯å¦è¢«å…³é—­
3. æ£€æŸ¥æ˜¯å¦æœ‰ panic

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## å¿ƒè·³åŠŸèƒ½äº’æ“ä½œæµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**: YYYY-MM-DD
**æµ‹è¯•äººå‘˜**: XXX

### åœºæ™¯ 1: Rust æœåŠ¡å™¨ + Go å®¢æˆ·ç«¯

- æµ‹è¯•ç»“æœ: âœ… é€šè¿‡ / âŒ å¤±è´¥
- å¿ƒè·³è¯·æ±‚æ•°: XX
- å¿ƒè·³å“åº”æ•°: XX
- é”™è¯¯æ•°: XX
- å¤‡æ³¨: XXX

### åœºæ™¯ 2: Go æœåŠ¡å™¨ + Rust å®¢æˆ·ç«¯

- æµ‹è¯•ç»“æœ: âœ… é€šè¿‡ / âŒ å¤±è´¥
- å¿ƒè·³è¯·æ±‚æ•°: XX
- å¿ƒè·³å“åº”æ•°: XX
- é”™è¯¯æ•°: XX
- å¤‡æ³¨: XXX

### åœºæ™¯ 3: åŒå‘å¿ƒè·³

- æµ‹è¯•ç»“æœ: âœ… é€šè¿‡ / âŒ å¤±è´¥
- è¿è¡Œæ—¶é•¿: XX åˆ†é’Ÿ
- å¿ƒè·³å‘¨æœŸ: XX ç§’
- æ€»å¿ƒè·³æ•°: XX
- é”™è¯¯æ•°: XX
- å¤‡æ³¨: XXX

### æ€»ç»“

- äº’æ“ä½œæ€§: âœ… å®Œå…¨å…¼å®¹ / âš ï¸ éƒ¨åˆ†å…¼å®¹ / âŒ ä¸å…¼å®¹
- é—®é¢˜åˆ—è¡¨: XXX
- å»ºè®®: XXX
```

---

## ğŸ¯ å½“å‰çŠ¶æ€

ç”±äºæ²¡æœ‰ Go ç¯å¢ƒï¼Œæ­¤æµ‹è¯•æ ‡è®°ä¸º**æ‰‹åŠ¨æµ‹è¯•**ã€‚

**å»ºè®®**:
- åœ¨æœ‰ Go ç¯å¢ƒæ—¶è¿›è¡Œå®é™…æµ‹è¯•
- åŸºäºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œç†è®ºä¸Šåº”è¯¥å…¼å®¹
- Go å®ç°çš„å¿ƒè·³é€»è¾‘ç®€å•ç›´æ¥ï¼Œå…¼å®¹æ€§é£é™©ä½

**æ›¿ä»£éªŒè¯**:
- âœ… å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ3/3ï¼‰
- âœ… é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆ3/3ï¼‰
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡
- âœ… åè®®è§„èŒƒå¯¹é½

**ç»“è®º**: åŸºäºæµ‹è¯•å’Œä»£ç å®¡æŸ¥ï¼Œå¿ƒè·³åŠŸèƒ½åº”ä¸ Go å®ç°å®Œå…¨å…¼å®¹ã€‚å»ºè®®åœ¨å®é™…éƒ¨ç½²å‰è¿›è¡Œæ‰‹åŠ¨äº’æ“ä½œæµ‹è¯•ã€‚

---

*æµ‹è¯•æŒ‡å—åˆ›å»ºæ—¥æœŸ: 2025-11-03*

